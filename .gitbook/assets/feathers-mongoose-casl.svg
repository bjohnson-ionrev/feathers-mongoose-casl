<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="1166px" height="1732px" viewBox="-0.5 -0.5 1166 1732" content="&lt;mxfile modified=&quot;2019-05-20T07:57:14.501Z&quot; host=&quot;www.draw.io&quot; agent=&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_13_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/74.0.3729.157 Safari/537.36&quot; etag=&quot;bKjEN2sd02UIbwLkMqIc&quot; version=&quot;10.6.7&quot; type=&quot;google&quot;&gt;&lt;diagram name=&quot;Page-1&quot; id=&quot;efa7a0a1-bf9b-a30e-e6df-94a7791c09e9&quot;&gt;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&lt;/diagram&gt;&lt;/mxfile&gt;" style="background-color: rgb(255, 255, 255);"><defs/><g><rect x="264" y="550" width="900" height="450" fill="#ffffff" stroke="#000000" stroke-width="2" pointer-events="none"/><rect x="568" y="0" width="320" height="120" fill="#000000" stroke="#000000" stroke-width="2" transform="translate(4,6)" opacity="0.25"/><rect x="568" y="0" width="320" height="120" fill="#d4e1f5" stroke="#003366" stroke-width="2" pointer-events="none"/><g transform="translate(569.5,1.5)scale(2)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="158" height="58" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 51, 102); line-height: 1.2; vertical-align: top; width: 159px; height: 59px; overflow: hidden; white-space: nowrap;"><p style="margin: 0px ; margin-top: 4px ; text-align: center ; text-decoration: underline"><b>Client</b></p><hr /><p style="margin: 0px ; margin-left: 8px">Send request to server<br /></p></div></foreignObject><text x="79" y="35" fill="#003366" text-anchor="middle" font-size="12px" font-family="Helvetica">[Not supported by viewer]</text></switch></g><path d="M 727 160 L 727.84 227.26" fill="none" stroke="#000000" stroke-width="2" stroke-miterlimit="10" pointer-events="none"/><path d="M 727.97 237.76 L 720.8 223.85 L 727.84 227.26 L 734.8 223.68 Z" fill="#000000" stroke="#000000" stroke-width="2" stroke-miterlimit="10" pointer-events="none"/><path d="M 728 440 L 728 480 L 728 460 L 728 487.26" fill="none" stroke="#000000" stroke-width="2" stroke-miterlimit="10" pointer-events="none"/><path d="M 728 497.76 L 721 483.76 L 728 487.26 L 735 483.76 Z" fill="#000000" stroke="#000000" stroke-width="2" stroke-miterlimit="10" pointer-events="none"/><rect x="568" y="240" width="320" height="200" fill="#000000" stroke="#000000" stroke-width="2" transform="translate(4,6)" opacity="0.25"/><rect x="568" y="240" width="320" height="200" fill="#d5e8d4" stroke="#82b366" stroke-width="2" pointer-events="none"/><g transform="translate(569.5,241.5)scale(2)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="158" height="98" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 159px; height: 99px; overflow: hidden; white-space: nowrap;"><p style="margin: 4px 0px 0px ; text-align: center"><b><u>hooks.authenticate</u></b><br /></p><hr /><p style="margin: 0px ; margin-left: 8px">Looking for jwt, when token<br />found, call user from DB<br />and add the user to<br />params.user<br /><br /></p></div></foreignObject><text x="79" y="55" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">[Not supported by viewer]</text></switch></g><rect x="548" y="500" width="400" height="40" fill="#000000" stroke="#000000" stroke-width="2" transform="translate(4,6)" opacity="0.25"/><rect x="548" y="500" width="400" height="40" fill="#d5e8d4" stroke="#82b366" stroke-width="2" pointer-events="none"/><g transform="translate(549.5,501.5)scale(2)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="198" height="18" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 199px; height: 19px; overflow: hidden; white-space: nowrap;"><p style="margin: 4px 0px 0px ; text-align: center"><b>hooks.validateAbilites</b></p><p style="margin: 0px ; margin-left: 8px"><br /><br /></p></div></foreignObject><text x="99" y="15" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">[Not supported by viewer]</text></switch></g><path d="M 722 549 L 654.89 617.88" fill="none" stroke="#000000" stroke-width="2" stroke-miterlimit="10" pointer-events="none"/><path d="M 647.56 625.4 L 652.32 610.49 L 654.89 617.88 L 662.34 620.26 Z" fill="#000000" stroke="#000000" stroke-width="2" stroke-miterlimit="10" pointer-events="none"/><rect x="308" y="640" width="380" height="60" fill="#f5f5f5" stroke="#666666" stroke-width="2" pointer-events="none"/><g transform="translate(365.5,643.5)scale(2)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="132" height="26" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(51, 51, 51); line-height: 1.2; vertical-align: top; width: 132px; white-space: nowrap; overflow-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">service.options.<br />skipAbilitiesCheck = true</div></div></foreignObject><text x="66" y="19" fill="#333333" text-anchor="middle" font-size="12px" font-family="Helvetica">service.options.&lt;br&gt;skipAbilitiesCheck = true</text></switch></g><path d="M 748 550 L 800.36 619.81" fill="none" stroke="#000000" stroke-width="2" stroke-miterlimit="10" pointer-events="none"/><path d="M 806.66 628.21 L 792.66 621.21 L 800.36 619.81 L 803.86 612.81 Z" fill="#000000" stroke="#000000" stroke-width="2" stroke-miterlimit="10" pointer-events="none"/><path d="M 908 700 L 908 740 L 908 720 L 908 747.26" fill="none" stroke="#000000" stroke-width="2" stroke-miterlimit="10" pointer-events="none"/><path d="M 908 757.76 L 901 743.76 L 908 747.26 L 915 743.76 Z" fill="#000000" stroke="#000000" stroke-width="2" stroke-miterlimit="10" pointer-events="none"/><rect x="708" y="640" width="400" height="60" fill="#f5f5f5" stroke="#666666" stroke-width="2" pointer-events="none"/><g transform="translate(771.5,643.5)scale(2)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="136" height="26" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(51, 51, 51); line-height: 1.2; vertical-align: top; width: 136px; white-space: nowrap; overflow-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;"> service.options.<br />skipAbilitiesCheck = false</div></div></foreignObject><text x="68" y="19" fill="#333333" text-anchor="middle" font-size="12px" font-family="Helvetica"> service.options.&lt;br&gt;skipAbilitiesCheck = false</text></switch></g><rect x="708" y="760" width="400" height="180" fill="#f5f5f5" stroke="#666666" stroke-width="2" pointer-events="none"/><g transform="translate(713.5,767.5)scale(2)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="196" height="82" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(51, 51, 51); line-height: 1.2; vertical-align: top; width: 196px; white-space: normal; overflow-wrap: normal;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">1. Get rules<br />2. Define Abilities<br />3. Check user ability -<b> throw Error when not able</b> <br />4. Remove fields from request and add query to mongos query by rules<br /></div></div></foreignObject><text x="98" y="47" fill="#333333" text-anchor="middle" font-size="12px" font-family="Helvetica">[Not supported by viewer]</text></switch></g><rect x="528" y="1068" width="400" height="120" fill="#000000" stroke="#000000" stroke-width="2" transform="translate(4,6)" opacity="0.25"/><rect x="528" y="1068" width="400" height="120" fill="#d5e8d4" stroke="#82b366" stroke-width="2" pointer-events="none"/><g transform="translate(529.5,1069.5)scale(2)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="198" height="58" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 199px; height: 59px; overflow: hidden; white-space: nowrap;"><p style="margin: 4px 0px 0px ; text-align: center"><b><u>hooks.validateSchema</u></b><br /></p><hr /><p style="margin: 0px ; margin-left: 8px">Validate user request with JOI- </p><b> throw Error when not valid</b></div></foreignObject><text x="99" y="35" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">[Not supported by viewer]</text></switch></g><path d="M 708 1002 L 708 1055.26" fill="none" stroke="#000000" stroke-width="2" stroke-miterlimit="10" pointer-events="none"/><path d="M 708 1065.76 L 701 1051.76 L 708 1055.26 L 715 1051.76 Z" fill="#000000" stroke="#000000" stroke-width="2" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(389.5,1101.5)scale(2)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="58" height="26" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 58px; white-space: normal; overflow-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">Skip on GET</div></div></foreignObject><text x="29" y="19" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">Skip on GET</text></switch></g><path d="M 704 1188 L 704 1287.26" fill="none" stroke="#000000" stroke-width="2" stroke-miterlimit="10" pointer-events="none"/><path d="M 704 1297.76 L 697 1283.76 L 704 1287.26 L 711 1283.76 Z" fill="#000000" stroke="#000000" stroke-width="2" stroke-miterlimit="10" pointer-events="none"/><path d="M 714 1436 L 714 1523.26" fill="none" stroke="#000000" stroke-width="2" stroke-miterlimit="10" pointer-events="none"/><path d="M 714 1533.76 L 707 1519.76 L 714 1523.26 L 721 1519.76 Z" fill="#000000" stroke="#000000" stroke-width="2" stroke-miterlimit="10" pointer-events="none"/><rect x="614" y="1316" width="200" height="120" fill="#f8cecc" stroke="#b85450" stroke-width="2" pointer-events="none"/><g transform="translate(619.5,1363.5)scale(2)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="93" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 94px; white-space: nowrap; overflow-wrap: normal;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">Make the request</div></div></foreignObject><text x="47" y="12" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">Make the request</text></switch></g><path d="M 208 1720 L 208 1480" fill="none" stroke="#000000" stroke-width="2" stroke-miterlimit="10" stroke-dasharray="6 6" pointer-events="none"/><path d="M 208 1480 L 628 1480" fill="none" stroke="#000000" stroke-width="2" stroke-miterlimit="10" stroke-dasharray="6 6" pointer-events="none"/><g transform="translate(-1.5,617.5)scale(2)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="89" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 89px; white-space: nowrap; overflow-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">App.hook.before</div></div></foreignObject><text x="45" y="12" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">App.hook.before</text></switch></g><path d="M 208 1238 L 208 220" fill="none" stroke="#000000" stroke-width="2" stroke-miterlimit="10" stroke-dasharray="6 6" pointer-events="none"/><path d="M 208 220 L 628 220" fill="none" stroke="#000000" stroke-width="2" stroke-miterlimit="10" stroke-dasharray="6 6" pointer-events="none"/><path d="M 204 1240 L 624 1240" fill="none" stroke="#000000" stroke-width="2" stroke-miterlimit="10" stroke-dasharray="6 6" pointer-events="none"/><path d="M 168 1614 L 315.26 1614" fill="none" stroke="#000000" stroke-width="2" stroke-miterlimit="10" pointer-events="none"/><path d="M 325.76 1614 L 311.76 1621 L 315.26 1614 L 311.76 1607 Z" fill="#000000" stroke="#000000" stroke-width="2" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(28.5,1601.5)scale(2)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="79" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 79px; white-space: nowrap; overflow-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">App.hook.after</div></div></foreignObject><text x="40" y="12" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">App.hook.after</text></switch></g><g transform="translate(298.5,1601.5)scale(2)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="89" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 89px; white-space: nowrap; overflow-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">App.hook.before</div></div></foreignObject><text x="45" y="12" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">App.hook.before</text></switch></g><path d="M 208 1728 L 628 1728" fill="none" stroke="#000000" stroke-width="2" stroke-miterlimit="10" stroke-dasharray="6 6" pointer-events="none"/><rect x="524" y="1538" width="400" height="120" fill="#000000" stroke="#000000" stroke-width="2" transform="translate(4,6)" opacity="0.25"/><rect x="524" y="1538" width="400" height="120" fill="#d5e8d4" stroke="#82b366" stroke-width="2" pointer-events="none"/><g transform="translate(525.5,1539.5)scale(2)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="198" height="58" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 199px; height: 59px; overflow: hidden; white-space: nowrap;"><p style="margin: 4px 0px 0px ; text-align: center"><b><u>hooks.sanitizedData</u></b><br /></p><hr /><p style="margin: 0px ; margin-left: 8px">Remove private fields from client<br />response</p></div></foreignObject><text x="99" y="35" fill="#000000" text-anchor="middle" font-size="12px" font-family="Helvetica">[Not supported by viewer]</text></switch></g></g></svg>